# coding: utf8

'''
Importando o simplejson para gerar os arquivos
no formato JSON e enviando para o calendario
'''
import simplejson as json

def index():
    # Consultando os servicos do usuario logado
    query = db.agenda.id > 0 and db.agenda.funcionario == session.auth.user.id and db.agenda.cliente == db.cliente.id
    agenda = db(query).select(orderby = db.agenda.data)
    teste = []
    
    result = dict()
    for ag in agenda:
        result["id"] = ag.agenda.id
        result["title"] = ag.cliente.nome
        result["start"] = ag.agenda.data.strftime('%Y-%m-%d')
        result = dict()
        print ag.cliente.nome, ag.agenda.data
        teste.append(result);
        # teste = json.dumps({'id':ag.agenda.id,'title':ag.cliente.nome,'start':ag.agenda.data.strftime('%Y-%m-%d')}, indent = 4)
    print teste
    return dict(teste = result)

def novo():
    return dict(form = crud.create(db.agenda))
